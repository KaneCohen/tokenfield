var Tokenfield=function(e){function t(n){if(s[n])return s[n].exports;var i=s[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var s={};return t.m=e,t.c=s,t.p="",t(0)}([function(e,t,s){e.exports=s(1).default},function(e,t,s){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){if(Array.isArray(e)){for(var t=0,s=Array(e.length);t<e.length;t++)s[t]=e[t];return s}return Array.from(e)}function r(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(){return(65536*(1+Math.random())|0).toString(16)+(65536*(1+Math.random())|0).toString(16)}function h(e){for(var t=[e];e.parentNode;)e=e.parentNode,t.push(e);return t}function m(e,t){return e.nodeName?e:(e=e.replace(/(\t|\n$)/g,""),L.innerHTML="",L.innerHTML=e,t===!0?L.childNodes:L.childNodes[0])}function c(e){if("string"==typeof e)return e;if(null===e)return"";var t=e+"";return"0"===t&&1/e===-(1/0)?"-0":t}function f(e){return e.key||String.fromCharCode(parseInt(e.keyIdentifier.substr(2),16))}function d(e){return e=c(e),e&&S.test(e)?e.replace(b,"\\$&"):e}function v(){var e={focusedItem:null,cache:{},timer:null,xhr:null,suggested:!1,suggestedItems:[],setItems:[],events:{},delimiters:{}},t={el:null,form:!0,mode:"tokenfield",addItemOnBlur:!1,addItemsOnPaste:!1,setItems:[],items:[],newItems:!0,multiple:!0,maxItems:0,keys:{17:"ctrl",16:"shift",91:"meta",8:"delete",27:"esc",37:"left",38:"up",39:"right",40:"down",46:"delete",65:"select",67:"copy",9:"delimiter",13:"delimiter",108:"delimiter"},delimiters:[],copyProperty:"name",copyDelimiter:", ",remote:{type:"GET",url:null,queryParam:"q",delay:300,timestampParam:"t",params:{},headers:{}},placeholder:null,inputType:"text",minChars:2,maxSuggest:10,filterSetItems:!0,itemLabel:"name",itemName:"items",newItemName:"items_new",itemValue:"id",newItemValue:"name",itemData:"name"};return{_defaults:e,_options:t}}Object.defineProperty(t,"__esModule",{value:!0});var _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p=function(){function e(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,s,n){return s&&e(t.prototype,s),n&&e(t,n),t}}(),g=s(2),I=n(g),y=s(3),k=n(y),w={},b=/[\\^$.*+?()[\]{}|]/g,S=RegExp(b.source),L=document.createElement("div"),x={containerTokenfield:'<div class="tokenfield tokenfield-mode-tokens">\n      <input class="tokenfield-copy-helper"\n        style="position:fixed;left:-1000000px"\n        tabindex="-1"\n        type="text"\n      />\n      <div class="tokenfield-set">\n        <ul></ul>\n      </div>\n      <input class="tokenfield-input" />\n      <div class="tokenfield-suggest">\n        <ul class="tokenfield-suggest-list"></ul>\n      </div>\n    </div>',containerList:'<div class="tokenfield tokenfield-mode-list">\n      <input class="tokenfield-input" />\n      <div class="tokenfield-suggest">\n        <ul class="tokenfield-suggest-list"></ul>\n      </div>\n      <div class="tokenfield-set">\n        <ul></ul>\n      </div>\n    </div>',suggestItem:'<li class="tokenfield-suggest-item"></li>',setItem:'<li class="tokenfield-set-item">\n      <span class="item-label"></span>\n      <a href="#" class="item-remove" tabindex="-1">Ã—</a>\n      <input class="item-input" type="hidden" />\n    </li>'},E=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,t);var s=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),n=v(),i=n._defaults,r=n._options;s.id=l(),s.key="key_"+s.id,s._vars=Object.assign({},i),s._options=Object.assign({},r,e),s._options.keys=Object.assign({},r.keys,e.keys),s._options.remote=Object.assign({},r.remote,e.remote),s._templates=Object.assign({},x,e.templates),s._vars.setItems=s._prepareData(s._options.setItems||[]),s._focused=!1,s._form=!1,s._html={};var a=s._options;if(a.delimiters.forEach(function(e){s._vars.delimiters[e]=!0}),a.el.nodeName)s.el=a.el;else{if("string"!=typeof a.el)throw new Error("Cannot create tokenfield without DOM Element.");var h=document.querySelector(a.el);if(!h)throw new Error("Selector: DOM Element "+a.el+" not found.");s.el=h}if(s.el.tokenfield=s,null===a.placeholder&&(a.placeholder=a.el.placeholder||""),!a.form)throw new Error("Cannot create tokenfield without DOM Element.");var m=!1;if(a.form.nodeName)m=a.form;else if(a.form===!0)for(var c=s.el;c.parentNode;){if("FORM"===c.nodeName){m=c;break}c=c.parentNode}else if("string"==typeof m&&(m=document.querySelector(m),!m))throw new Error("Selector: DOM Element "+a.form+" not found.");return s._form=m,w[s.id]=s,s._render(),s}return a(t,e),p(t,[{key:"_render",value:function(){var e=this._options,t=this._html;return"tokenfield"===e.mode?t.container=m(this._templates.containerTokenfield):t.container=m(this._templates.containerList),t.suggest=t.container.querySelector(".tokenfield-suggest"),t.suggestList=t.container.querySelector(".tokenfield-suggest-list"),t.items=t.container.querySelector(".tokenfield-set > ul"),t.input=t.container.querySelector(".tokenfield-input"),t.input.setAttribute("type",e.inputType),t.input.placeholder=e.placeholder,t.copyHelper=t.container.querySelector(".tokenfield-copy-helper"),e.el.style.display="none",t.suggest.style.display="none",this._renderSizer(),t.container.tokenfield=this,e.el.parentElement.insertBefore(t.container,e.el),t.container.insertBefore(e.el,t.container.firstChild),this._setEvents(),this._renderItems(),"tokenfield"===e.mode&&this._resizeInput(),this}},{key:"_renderSizer",value:function(){var e=this._html,t=this._getBounds(),s=window.getComputedStyle(e.container),n=parseInt(s.paddingLeft,10)+parseInt(s.paddingRight,10),i={width:"auto",height:"auto",overflow:"hidden",whiteSpace:"pre",maxWidth:t.width-n+"px",position:"fixed",top:-1e4+"px",left:1e4+"px",fontSize:s.fontSize,paddingLeft:s.paddingLeft,paddingRight:s.paddingRight};e.sizer=document.createElement("div"),e.sizer.id="tokenfield-sizer-"+this.id;for(var r in i)e.sizer.style[r]=i[r];e.container.appendChild(e.sizer)}},{key:"_refreshInput",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this._vars,s=this._html;if(e&&(s.input.value=""),"tokenfield"===this._options.mode){this._resizeInput();var n=t.setItems.length?"":this._options.placeholder;s.input.setAttribute("placeholder",n)}return this}},{key:"_resizeInput",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=this._html,s=this._getBounds(),n=window.getComputedStyle(t.container),i=parseInt(n.paddingRight,10)+parseInt(n.borderRightWidth,10),r=i+parseInt(n.paddingLeft,10)+parseInt(n.borderLeftWidth,10);t.sizer.innerHTML=e,t.input.style.width="20px";var o=t.sizer.getBoundingClientRect(),u=t.input.getBoundingClientRect(),a=s.width-(u.left-s.left)-i;o.width>a?t.input.style.width=s.width-r+"px":t.input.style.width=a+"px"}},{key:"_fetchData",value:function(e){var t=this,s=this._vars,n=this._options,i=n.remote,r=Object.assign({},n.params);for(var o in i.params)r[o]=i.params[o];i.limit&&(r[i.limit]=n.remote.limit),r[i.queryParam]=e,r[i.timestampParam]=Math.round((new Date).getTime()/1e3),s.xhr=(0,k.default)(r,n.remote,function(){if(4==s.xhr.readyState){if(200==s.xhr.status){var i=JSON.parse(s.xhr.responseText);s.cache[e]=i;var r=t._prepareData(t.remapData(i)),o=t._filterData(e,r);s.suggestedItems=n.filterSetItems?t._filterSetItems(o):o,t.showSuggestions()}else if(s.xhr.status>0)throw new Error("Error while loading remote data.");t._abortXhr()}})}},{key:"remapData",value:function(e){return e}},{key:"_prepareData",value:function(e){var t=this;return e.map(function(e){return Object.assign({},e,r({},t.key,l()))})}},{key:"_filterData",value:function(e,t){var s=this._options,n=new RegExp(d(e),"i");return t.filter(function(e){return n.test(e[s.itemData])})}},{key:"_abortXhr",value:function(){var e=this._vars;null!==e.xhr&&(e.xhr.abort(),e.xhr=null)}},{key:"_filterSetItems",value:function(e){var t=this._options.itemValue,s=this._vars;if(!s.setItems.length)return e;var n=s.setItems.map(function(e){return e[t]});return e.filter(function(e){return n.indexOf(e[t])===-1})}},{key:"_setEvents",value:function(){var e=this._vars,t=this._html;e.events.onClick=this._onClick.bind(this),e.events.onMouseDown=this._onMouseDown.bind(this),e.events.onMouseOver=this._onMouseOver.bind(this),e.events.onFocus=this._onFocus.bind(this),e.events.onResize=this._onResize.bind(this),e.events.onReset=this._onReset.bind(this),e.events.onKeyDown=this._onKeyDown.bind(this),e.events.onFocusOut=this._onFocusOut.bind(this),t.container.addEventListener("click",e.events.onClick),1===Object.keys(w).length&&(document.addEventListener("mousedown",e.events.onMouseDown),window.addEventListener("resize",e.events.onResize)),this._form&&this._form.nodeName&&this._form.addEventListener("reset",e.events.onReset),t.suggestList.addEventListener("mouseover",e.events.onMouseOver),t.input.addEventListener("focus",e.events.onFocus)}},{key:"_onMouseOver",value:function(e){var t=e.target;if(t.classList.contains("tokenfield-suggest-item")){var s=[].concat(i(this._html.suggestList.querySelectorAll(".selected")));s.forEach(function(e){e!==t&&e.classList.remove("selected")}),t.classList.add("selected"),this._selectItem(t.key),this._refreshItemsSelection()}}},{key:"_onReset",value:function(){this.setItems(this._options.setItems)}},{key:"_onFocus",value:function(e){var t=this._vars,s=this._html,n=this._options;s.input.removeEventListener("keydown",t.events.onKeyDown),s.input.addEventListener("keydown",t.events.onKeyDown),s.input.addEventListener("focusout",t.events.onFocusOut),n.addItemsOnPaste&&(t.events.onPaste=this._onPaste.bind(this),s.input.addEventListener("paste",t.events.onPaste)),this.focus(),this._focused=!0,s.input.value.trim().length>=n.minChars&&this.showSuggestions()}},{key:"_onFocusOut",value:function(e){var t=this._vars,s=this._options,n=this._html;if(n.input.removeEventListener("keydown",t.events.onKeyDown),n.input.removeEventListener("focusout",t.events.onFocusOut),"undefined"!=typeof t.events.onPaste&&n.input.removeEventListener("paste",t.events.onPaste),!e.relatedTarget||e.relatedTarget!==n.copyHelper){var i=!s.maxItems||s.maxItems&&t.setItems.length<s.maxItems;this._focused&&s.addItemOnBlur&&i&&this._newItem(n.input.value)?this._renderItems()._refreshInput().focus():this._defocusItems()._renderItems(),this._focused=!1}}},{key:"_onMouseDown",value:function(e){var t=null;for(var s in w)if(w[s]._html.container.contains(e.target)){t=w[s];break}if(t){for(var n in w)n!==t.id&&(w[n].hideSuggestions(),w[n].blur());e.target!==t._html.input&&e.preventDefault()}else for(var i in w)w[i].hideSuggestions(),w[i].blur()}},{key:"_onResize",value:function(){for(var e in w)w[e]._resizeInput(w[e]._html.input.value)}},{key:"_onPaste",value:function(e){var t=this,s=this._vars,n=this._options,i=e.clipboardData.getData("text"),r=[i];if(n.delimiters.length){var o=n.delimiters.join("|"),u=new RegExp("("+o+")","ig");r=i.split(u)}var a=r.map(function(e){return e.trim()}).filter(function(e){return e.length>0&&e.length>=n.minChars&&"undefined"==typeof s.delimiters[e]}).map(function(e){return t._newItem(e)});a.length&&(setTimeout(function(){t._renderItems()._refreshInput()._deselectItems().hideSuggestions()},1),e.preventDefault())}},{key:"_onKeyDown",value:function(e){var t=this,s=this._vars,n=this._options,i=this._html;n.maxItems&&s.setItems.length>=n.maxItems&&e.preventDefault(),"tokenfield"===n.mode&&setTimeout(function(){t._resizeInput(i.input.value)},1);var r=f(e);return"undefined"!=typeof n.keys[e.keyCode]||n.delimiters.includes(r)?(this._keyAction(e),!0):(this._defocusItems()._refreshItems(),clearTimeout(s.timer),this._abortXhr(),void((!n.maxItems||s.setItems.length<n.maxItems)&&setTimeout(function(){t._keyInput(e)},1)))}},{key:"_keyAction",value:function(e){var t=this,s=null,n=this._vars,i=this.key,r=this._options,o=this._html,u=r.keys[e.keyCode],a=o.input.value.trim(),l=f(e);r.delimiters.includes(l)&&"undefined"==typeof u&&(u="delimiter");var h=this._getSelectedItems();switch(h.length&&(s=h[0]),u){case"esc":this._deselectItems()._defocusItems()._renderItems().hideSuggestions();break;case"up":this._vars.suggested&&(this._selectPrevItem()._refreshItemsSelection(),e.preventDefault()),this._defocusItems()._renderItems();break;case"down":this._vars.suggested&&(this._selectNextItem()._refreshItemsSelection(),e.preventDefault()),this._defocusItems()._renderItems();break;case"left":(this.getFocusedItems().length||!o.input.selectionStart&&!o.input.selectionEnd)&&(this._focusPrevItem(e.shiftKey),e.preventDefault());break;case"right":(this.getFocusedItems().length||o.input.selectionStart===a.length)&&(this._focusNextItem(e.shiftKey),e.preventDefault());break;case"delimiter":if(this._abortXhr(),this._defocusItems(),1==n.setItems.length&&!r.multiple)return!1;a=this.onInput(a),s?this._addItem(s):a.length&&(s=this._newItem(a)),s&&this._renderItems().focus()._refreshInput()._refreshSuggestions()._deselectItems(),e.preventDefault();break;case"select":a.length||!e.ctrlKey&&!e.metaKey||(this._vars.setItems.forEach(function(e){e.focused=!0}),this._refreshItems());break;case"copy":var m=this.getFocusedItems();if(m.length&&(e.ctrlKey||e.metaKey)){var c=this._vars.setItems.filter(function(e){return e.focused}).map(function(e){return e[r.copyProperty]}).join(r.copyDelimiter);o.copyHelper.value=c,o.copyHelper.focus(),o.copyHelper.select(),document.execCommand("copy"),o.copyHelper.value="",o.input.focus()}break;case"delete":this._abortXhr();var d=this.getFocusedItems();!o.input.selectionEnd&&8===e.keyCode||o.input.selectionStart===a.length&&46===e.keyCode||d.length?(this.hideSuggestions(),"tokenfield"===r.mode&&n.setItems.length?d.length?d.forEach(function(e){t._removeItem(e[i])}):o.input.selectionStart||this._focusItem(n.setItems[n.setItems.length-1][i]):d.length&&d.forEach(function(e){t._removeItem(e[i])}),this._renderItems()._refreshInput(!1)):n.timer=setTimeout(function(){t._keyInput(e)},r.delay)}}},{key:"_keyInput",value:function(e){var t=this,s=this._vars,n=this._options,i=this._html;this._defocusItems()._refreshItems();var r=this.onInput(i.input.value.trim(),e);if("keydown"===e.type&&this.emit("input",this,r,e),r.length<n.minChars)return this.hideSuggestions(),!1;if(1==s.setItems.length&&!n.multiple)return!1;if("undefined"==typeof s.cache[r]){if(n.remote.url)s.timer=setTimeout(function(){t._fetchData(r)},n.delay);else if(!n.remote.url&&n.items.length){var o=this._prepareData(n.items),u=this._filterData(r,o);s.suggestedItems=n.filterSetItems?this._filterSetItems(u):u,this.showSuggestions()}}else{var a=this._prepareData(this.remapData(s.cache[r])),l=this._filterData(r,a);s.suggestedItems=n.filterSetItems?this._filterSetItems(l):l,this.showSuggestions()}return this}},{key:"_onClick",value:function(e){var t=e.target;if(t.classList.contains("item-remove"))e.preventDefault(),this._removeItem(t.key)._defocusItems()._renderItems()._keyInput(e),this.focus();else if(t.classList.contains("tokenfield-suggest-item")){var s=this._getSuggestedItem(t.key);this._addItem(s)._renderItems()._refreshInput()._refreshSuggestions().focus()}else{var n=h(t).filter(function(e){return e.classList&&e.classList.contains("tokenfield-set-item")})[0];n?(this._focusItem(n.key,e.shiftKey,e.ctrlKey||e.metaKey,!0),this._refreshItems()):this._keyInput(e),this.focus()}}},{key:"_selectPrevItem",value:function(){var e=this.key,t=this._options,s=this._vars.suggestedItems,n=this._getSelectedItemIndex();return s.length?(null!==n?0===n?t.newItems?this._deselectItems():this._selectItem(s[s.length-1][e]):this._selectItem(s[n-1][e]):this._selectItem(s[s.length-1][e]),this):this}},{key:"_selectNextItem",value:function(){var e=this.key,t=this._options,s=this._vars.suggestedItems,n=this._getSelectedItemIndex();return s.length?(null!==n?n===s.length-1?t.newItems?this._deselectItems():this._selectItem(s[0][e]):this._selectItem(s[n+1][e]):this._selectItem(s[0][e]),this):this}},{key:"_focusPrevItem",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.key,s=this._vars.setItems,n=this._getFocusedItemIndex();if(!s.length)return this;if(null!==n)if(0!==n||e)if(0===n&&e){var i=this._getFocusedItemIndex(!0);this._defocusItem(s[i][t])}else this._focusItem(s[n-1][t],e,!1,!0);else this._defocusItems();else this._focusItem(s[s.length-1][t],!1,!1,!0);return this._refreshItems(),this}},{key:"_focusNextItem",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.key,s=this._vars.setItems,n=this._getFocusedItemIndex(!0);return s.length?(null!==n?n!==s.length-1||e?n===s.length-1&&e?this._focusItem(s[0][t],e):this._focusItem(s[n+1][t],e):this._defocusItems():this._focusItem(s[0][t],!1),this._refreshItems(),this):this}},{key:"_getSelectedItems",value:function(){var e=this.key,t=this._vars.setItems.map(function(t){return t[e]});return this._vars.suggestedItems.filter(function(s){return s.selected&&t.indexOf(s[e])<0})}},{key:"_selectItem",value:function(e){var t=this;this._vars.suggestedItems.forEach(function(s){s.selected=s[t.key]===e})}},{key:"_deselectItem",value:function(e){var t=this;return this._vars.suggestedItems.every(function(s){return s[t.key]!==e||(s.selected=!1,!1)}),this}},{key:"_deselectItems",value:function(){return this._vars.suggestedItems.forEach(function(e){e.selected=!1}),this}},{key:"_refreshItemsSelection",value:function(){this._vars.suggestedItems.forEach(function(e){e.selected&&e.el?e.el.classList.add("selected"):e.el&&e.el.classList.remove("selected")})}},{key:"_getSelectedItemIndex",value:function(){var e=null;return this._vars.suggestedItems.every(function(t,s){return!t.selected||(e=s,!1)}),e}},{key:"_getFocusedItemIndex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=null;return this._vars.setItems.every(function(s,n){return!(s.focused&&(t=n,!e))}),t}},{key:"_getItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===t&&(t=this.key);var s=this._filterItems(this._vars.setItems,e,t);return s.length?s[0]:null}},{key:"_getSuggestedItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===t&&(t=this.key);var s=this._filterItems(this._vars.suggestedItems,e,t);return s.length?s[0]:null}},{key:"_getAvailableItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===t&&(t=this.key);var s=this._filterItems(this._options.items,e,t);return s.length?s[0]:null}},{key:"_filterItems",value:function(e,t,s){return e.filter(function(e){return"string"==typeof e[s]&&"string"==typeof t?e[s].toLowerCase()==t.toLowerCase():e[s]==t})}},{key:"_removeItem",value:function(e){var t=this;return this._vars.setItems.every(function(s,n){return s[t.key]!==e||(t.emit("removeToken",t,s),t._vars.setItems.splice(n,1),t.emit("removedToken",t,s),t.emit("change",t),!1)}),this}},{key:"_addItem",value:function(e){e.focused=!1;var t=this._options;if((e.isNew&&!this._getItem(e[t.itemData],t.itemData)||!this._getItem(e[t.itemValue],t.itemValue))&&(this.emit("addToken",this,e),!this._options.maxItems||this._options.maxItems&&this._vars.setItems.length<this._options.maxItems)){e.selected=!1;var s=Object.assign({},e);this._vars.setItems.push(s),this.emit("addedToken",this,s),this.emit("change",this)}return this}},{key:"getFocusedItem",value:function(){var e=this._vars.setItems.filter(function(e){return e.focused})[0];return e.length?e[0]:null}},{key:"getFocusedItems",value:function(){return this._vars.setItems.filter(function(e){return e.focused})}},{key:"_focusItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=this,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(t){var r=function(){var t=null,n=null,r=null,o=s._vars.setItems.length;return s._vars.setItems.forEach(function(i,o){i[s.key]===e&&(r=o),null===t&&i.focused&&(t=o),i.focused&&(n=o)}),0!==r&&r!==o-1||null!==t||null!==n?void(null===t&&null===n?s._vars.setItems[r].focused=!0:0!==r||n!==o-1||i?(t=Math.min(r,t),n=Math.max(r,n),s._vars.setItems.forEach(function(e,s){e.focused=r===s||s>=t&&s<=n})):s._vars.setItems[t].focused=!1):{v:void 0}}();if("object"===("undefined"==typeof r?"undefined":_(r)))return r.v}else this._vars.setItems.forEach(function(t){n?t.focused=t[s.key]===e?!t.focused:t.focused:t.focused=t[s.key]===e});return this}},{key:"_defocusItem",value:function(e){var t=this;return this._vars.setItems.filter(function(s){s[t.key]===e&&(s.focused=!1)})}},{key:"_defocusItems",value:function(){return this._vars.setItems.forEach(function(e){e.focused=!1}),this}},{key:"_newItem",value:function(e){if("string"==typeof e&&!e.length)return null;var t=this._options,s=this._getItem(e,t.itemData)||this._getSuggestedItem(e,t.itemData)||this._getAvailableItem(e,t.itemData);if(!s&&t.newItems){var n;n={isNew:!0},r(n,this.key,l()),r(n,t.itemData,e),s=n,this.emit("newToken",this,s)}return s?(this._addItem(s),s):null}},{key:"_buildEl",value:function(e){return m(e)}},{key:"_getBounds",value:function(){return this._html.container.getBoundingClientRect()}},{key:"_renderItems",value:function(){var e=this,t=this._vars,s=this._options,n=this._html;return n.items.innerHTML="",t.setItems.forEach(function(t){var s=e._renderItem(t);n.items.appendChild(s),t.el=s,t.focused?t.el.classList.add("focused"):t.el.classList.remove("focused")}),t.setItems.length>1&&"tokenfield"===s.mode&&n.input.setAttribute("placeholder",""),this}},{key:"_refreshItems",value:function(){var e=this._vars;e.setItems.forEach(function(e){e.el&&(e.focused?e.el.classList.add("focused"):e.el.classList.remove("focused"))})}},{key:"_renderItem",value:function(e){var t=this._options,s=this.renderSetItemHtml(e),n=s.querySelector(".item-label"),i=s.querySelector(".item-input"),r=s.querySelector(".item-remove");return s.key=e[this.key],r.key=e[this.key],i.setAttribute("name",(e.isNew?t.newItemName:t.itemName)+"[]"),i.value=e[e.isNew?t.newItemValue:t.itemValue]||null,n.textContent=this.renderSetItemLabel(e),e.focused&&s.classList.add("focused"),s}},{key:"onInput",value:function(e,t){return e}},{key:"renderSetItemHtml",value:function(){return this._buildEl(this._templates.setItem)}},{key:"renderSetItemLabel",value:function(e){return e[this._options.itemLabel]}},{key:"renderSuggestions",value:function(e){var t=this,s=this._vars,n=this._options,i=this._html,r=this._getSelectedItemIndex();return e.length?(i.suggestList.innerHTML="",s.suggestedItems.length?(n.newItems||null!==r||(e[0].selected=!0),e.every(function(e,s){if(s>=n.maxSuggest)return!1;var r=t.renderSuggestedItem(e);return e.el=r,i.suggestList.appendChild(r),!0}),this):this):this}},{key:"renderSuggestedItem",value:function(e){var t=this._options,s=this._buildEl(this._templates.suggestItem);if(s.key=e[this.key],s.innerHTML=e[t.itemData],s.setAttribute("title",e[t.itemData]),e.selected&&s.classList.add("selected"),!t.filterSetItems){var n=this._getItem(e[t.itemValue],t.itemValue)||this._getItem(e[t.itemData],t.itemData);n&&s.classList.add("set")}return s}},{key:"showSuggestions",value:function(){return this._vars.suggestedItems.length?(this.emit("showSuggestions",this),(!this._options.maxItems||this._options.maxItems&&this._vars.setItems.length<this._options.maxItems)&&(this.renderSuggestions(this._vars.suggestedItems),this._html.suggest.style.display="block",this._vars.suggested=!0),this.emit("shownSuggestions",this)):this.hideSuggestions(),this}},{key:"_refreshSuggestions",value:function(){var e=this._vars,t=this._options;if(this._html.input.value.length<t.minChars)return this.hideSuggestions(),this;var s=this._prepareData(t.items),n=this._filterData(this._html.input.value,s);return e.suggestedItems=t.filterSetItems?this._filterSetItems(n):n,e.suggestedItems.length&&(!t.maxItems||t.maxItems&&e.setItems.length<t.maxItems)?this.renderSuggestions(e.suggestedItems):this.hideSuggestions(),this}},{key:"hideSuggestions",value:function(){return this.emit("hideSuggestions",this),this._vars.suggested=!1,this._html.suggest.style.display="none",this._html.suggestList.innerHTML="",this.emit("hiddenSuggestions",this),this}},{key:"getItems",value:function(){return this._vars.setItems.map(function(e){return Object.assign({},e)})}},{key:"setItems",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Array.isArray(e)||(e=[e]),this._vars.setItems=this._prepareData(e||[]),this._renderItems()._refreshInput().hideSuggestions(),this.emit("change",this),this}},{key:"addItems",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=this._options.itemValue;Array.isArray(e)||(e=[e]);var s={};if(this.getItems().forEach(function(e){s[e[t]]=!0}),e=e.filter(function(e){return s[e[t]]!==!0}),!e.length)return this;var n=this._prepareData(e);return this._vars.setItems=this._vars.setItems.concat(n),this._renderItems()._refreshInput().hideSuggestions(),this.emit("change",this),this}},{key:"removeItem",value:function(e){var t=this._options;"object"===("undefined"==typeof e?"undefined":_(e))&&(e[t.itemValue]||e[t.newItemValue])&&(e=e[t.itemValue]||e[t.newItemValue]);var s=this._getItem(e,t.itemValue)||this._getItem(e,t.newItemValue);return s?(this._removeItem(s[this.key])._renderItems(),this):this}},{key:"emptyItems",value:function(){return this._vars.setItems=[],this._renderItems()._refreshInput().hideSuggestions(),this.emit("change",this),this}},{key:"getSuggestedItems",value:function(){return this._vars.suggestedItems.map(function(e){return Object.assign({},e)})}},{key:"focus",value:function(){return this._html.container.classList.add("focused"),this._html.input.focus(),this}},{key:"blur",value:function(){return this._html.container.classList.remove("focused"),this._html.input.blur(),this}},{key:"remove",value:function(){var e=this._html;e.container.parentElement.insertBefore(this.el,e.container),e.container.remove(),this.el.style.display="block",1===Object.keys(w).length&&(document.removeEventListener("mousedown",this._vars.events.onMouseDown),window.removeEventListener("resize",this._vars.events.onResize)),this._form&&this._form.nodeName&&this._form.removeEventListener("reset",this._vars.events.onReset),delete w[this.id],delete this.el.tokenfield}}]),t}(I.default);t.default=E},function(e,t){function s(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return"function"==typeof e}function i(e){return"number"==typeof e}function r(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}e.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._maxListeners=void 0,s.defaultMaxListeners=10,s.prototype.setMaxListeners=function(e){if(!i(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},s.prototype.emit=function(e){var t,s,i,u,a,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var h=new Error('Uncaught, unspecified "error" event. ('+t+")");throw h.context=t,h}if(s=this._events[e],o(s))return!1;if(n(s))switch(arguments.length){case 1:s.call(this);break;case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:u=Array.prototype.slice.call(arguments,1),s.apply(this,u)}else if(r(s))for(u=Array.prototype.slice.call(arguments,1),l=s.slice(),i=l.length,a=0;a<i;a++)l[a].apply(this,u);return!0},s.prototype.addListener=function(e,t){var i;if(!n(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(t.listener)?t.listener:t),this._events[e]?r(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,r(this._events[e])&&!this._events[e].warned&&(i=o(this._maxListeners)?s.defaultMaxListeners:this._maxListeners,i&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},s.prototype.on=s.prototype.addListener,s.prototype.once=function(e,t){function s(){this.removeListener(e,s),i||(i=!0,t.apply(this,arguments))}if(!n(t))throw TypeError("listener must be a function");var i=!1;return s.listener=t,this.on(e,s),this},s.prototype.removeListener=function(e,t){var s,i,o,u;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(s=this._events[e],o=s.length,i=-1,s===t||n(s.listener)&&s.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(r(s)){for(u=o;u-- >0;)if(s[u]===t||s[u].listener&&s[u].listener===t){i=u;break}if(i<0)return this;1===s.length?(s.length=0,delete this._events[e]):s.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},s.prototype.removeAllListeners=function(e){var t,s;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(s=this._events[e],n(s))this.removeListener(e,s);else if(s)for(;s.length;)this.removeListener(e,s[s.length-1]);return delete this._events[e],this},s.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},s.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(n(t))return 1;if(t)return t.length}return 0},s.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t){"use strict";function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=new XMLHttpRequest,i=t.url,r=[];for(var o in e)r.push(o+"="+e[o]);var u=r.join("&");"get"===t.type.toLowerCase()&&(i+="?"+u),n.open(t.type,i,!0);for(var a in t.headers){var l=t.headers[a];"function"==typeof l&&(l=l(e,t)),n.setRequestHeader(a,l)}return s&&(n.onreadystatechange=s),n.send(e),n}Object.defineProperty(t,"__esModule",{value:!0}),t.default=s}]);