var Tokenfield=function(e){function t(n){if(s[n])return s[n].exports;var i=s[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var s={};return t.m=e,t.c=s,t.p="",t(0)}([function(e,t,s){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(){return(65536*(1+Math.random())|0).toString(16)+(65536*(1+Math.random())|0).toString(16)}function a(e,t){return e.nodeName?e:(e=e.replace(/(\t|\n$)/g,""),I.innerHTML="",I.innerHTML=e,t===!0?I.childNodes:I.childNodes[0])}function l(e){if("string"==typeof e)return e;if(null===e)return"";var t=e+"";return"0"===t&&1/e===-(1/0)?"-0":t}function h(e){return e=l(e),e&&y.test(e)?e.replace(p,"\\$&"):e}function m(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],s=arguments.length<=2||void 0===arguments[2]?null:arguments[2],n=new XMLHttpRequest,i=t.url,r=[];for(var o in e)r.push(o+"="+e[o]);var u=r.join("&");return"get"===t.type.toLowerCase()&&(i+="?"+u),n.open(t.type,i,!0),s&&(n.onreadystatechange=s),n.send(e),n}function c(){var e={keys:{8:"delete",9:"enter",13:"enter",27:"esc",37:"left",38:"up",39:"right",40:"down",46:"delete",108:"enter"},focusedItem:null,cache:{},timer:null,xhr:null,suggested:!1,suggestedItems:[],setItems:[],events:{}},t={el:null,mode:"tokenfield",setItems:[],items:[],newItems:!0,multiple:!0,maxItems:0,remote:{type:"GET",url:null,queryParam:"q",delay:300,timestampParam:"t",params:{}},placeholder:null,minChars:2,maxSuggest:10,itemLabel:"name",itemName:"items",newItemName:"items_new",itemValue:"id",newItemValue:"name",itemData:"name"};return{_defaults:e,_options:t}}Object.defineProperty(t,"__esModule",{value:!0});var d=function(){function e(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,s,n){return s&&e(t.prototype,s),n&&e(t,n),t}}(),v=function(e,t,s){for(var n=!0;n;){var i=e,r=t,o=s;n=!1,null===i&&(i=Function.prototype);var u=Object.getOwnPropertyDescriptor(i,r);if(void 0!==u){if("value"in u)return u.value;var a=u.get;if(void 0===a)return;return a.call(o)}var l=Object.getPrototypeOf(i);if(null===l)return;e=l,t=r,s=o,n=!0,u=l=void 0}},f=s(1),_=n(f),g={},p=/[\\^$.*+?()[\]{}|]/g,y=RegExp(p.source),I=document.createElement("div"),k={containerTokenfield:'<div class="tokenfield tokenfield-mode-tokens">\n      <div class="tokenfield-set">\n        <ul></ul>\n      </div>\n      <input class="tokenfield-input" />\n      <div class="tokenfield-suggest">\n        <ul class="tokenfield-suggest-list"></ul>\n      </div>\n    </div>',containerList:'<div class="tokenfield tokenfield-mode-list">\n      <input class="tokenfield-input" />\n      <div class="tokenfield-suggest">\n        <ul class="tokenfield-suggest-list"></ul>\n      </div>\n      <div class="tokenfield-set">\n        <ul></ul>\n      </div>\n    </div>',suggestItem:'<li class="tokenfield-suggest-item"></li>',setItem:'<li class="tokenfield-set-item">\n      <span class="item-label"></span>\n      <span class="item-remove">Ã—</span>\n      <input class="item-input" type="hidden" />\n    </li>'},w=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];r(this,t),v(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);var s=c(),n=s._defaults,i=s._options;this.id=u(),this.key="key_"+this.id,this._vars=Object.assign({},n),this._options=Object.assign({},i,e),this._options.remote=Object.assign({},i.remote,e.remote),this._templates=Object.assign({},k,e.templates),this._vars.setItems=this._options.setItems||[],this._html={};var o=this._options;if(!o.el)throw new Error("Cannot create tokenfield without DOM Element.");var a=o.el;if("string"==typeof a&&(a=document.querySelector(o.el),!a))throw new Error("Selector: DOM Element "+o.el+" not found.");a.tokenfield=this,this.el=a,null===o.placeholder&&(o.placeholder=o.el.placeholder||""),g[this.id]=this,this._render()}return o(t,e),d(t,[{key:"_render",value:function(){var e=this._options,t=this._html;return"tokenfield"===e.mode?t.container=a(this._templates.containerTokenfield):t.container=a(this._templates.containerList),t.suggest=t.container.querySelector(".tokenfield-suggest"),t.suggestList=t.container.querySelector(".tokenfield-suggest-list"),t.items=t.container.querySelector(".tokenfield-set > ul"),t.input=t.container.querySelector(".tokenfield-input"),t.input.placeholder=e.placeholder,e.el.style.display="none",t.suggest.style.display="none",this._renderSizer(),t.container.tokenfield=this,e.el.parentElement.insertBefore(t.container,e.el),t.container.appendChild(e.el),this._setEvents(),this._renderItems(),"tokenfield"===e.mode&&this._resizeInput(),this}},{key:"_renderSizer",value:function(){var e=this._html,t=this._getBounds(),s=window.getComputedStyle(e.container),n=parseInt(s.paddingLeft,10)+parseInt(s.paddingRight,10),i={width:"auto",height:"auto",overflow:"hidden",whiteSpace:"pre",maxWidth:t.width-n+"px",position:"fixed",top:"-100px",left:"-1000px",fontSize:s.fontSize,paddingLeft:s.paddingLeft,paddingRight:s.paddingRight};e.sizer=document.createElement("div"),e.sizer.id="tokenfield-sizer-"+this.id;for(var r in i)e.sizer.style[r]=i[r];e.container.appendChild(e.sizer)}},{key:"_refreshInput",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0],t=this._vars,s=this._html;if(s.input.value="",e===!0&&this.focus(),"tokenfield"===this._options.mode){this._resizeInput();var n=t.setItems.length?"":this._options.placeholder;s.input.setAttribute("placeholder",n)}return this}},{key:"_resizeInput",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0],t=this._html,s=this._getBounds(),n=window.getComputedStyle(t.container),i=parseInt(n.paddingLeft,10)+parseInt(n.paddingRight,10);t.sizer.innerHTML=e,t.input.style.width="20px";var r=t.sizer.getBoundingClientRect(),o=t.input.getBoundingClientRect(),u=s.width-(o.left-s.left)-i;r.width>u?t.input.style.width=s.width-i+"px":t.input.style.width=u+"px"}},{key:"_fetchData",value:function(e){var t=this,s=this._vars,n=this._options,i=n.remote,r=Object.assign({},n.params);for(var o in i.params)r[o]=i.params[o];i.limit&&(r[i.limit]=n.remote.limit),r[i.queryParam]=e,r[i.timestampParam]=Math.round((new Date).getTime()/1e3),s.xhr=m(r,n.remote,function(){if(4==s.xhr.readyState){if(200==s.xhr.status){var n=JSON.parse(s.xhr.responseText);s.cache[e]=n;var i=t._prepareData(t.remapData(n)),r=t._filterData(e,i);s.suggestedItems=t._filterSetItems(r),t.showSuggestions()}else if(s.xhr.status>0)throw new Error("Error while loading remote data.");t._abortXhr()}})}},{key:"remapData",value:function(e){return e}},{key:"_prepareData",value:function(e){var t=this;return e.map(function(e){return e[t.key]=u(),e})}},{key:"_filterData",value:function(e,t){var s=this._options,n=new RegExp(h(e),"i");return t.filter(function(e){return n.test(e[s.itemData])})}},{key:"_abortXhr",value:function(){var e=this._vars;null!==e.xhr&&(e.xhr.abort(),e.xhr=null)}},{key:"_filterSetItems",value:function(e){var t=this.key,s=this._vars;if(!s.setItems.length)return e;var n=s.setItems.map(function(e){return e[t]});return e.filter(function(e){return-1===n.indexOf(e[t])?!0:!1})}},{key:"_setEvents",value:function(){var e=this._vars,t=this._html;e.events.onClick=this._onClick.bind(this),e.events.onMouseDown=this._onMouseDown.bind(this),e.events.onMouseOver=this._onMouseOver.bind(this),e.events.onFocus=this._onFocus.bind(this),e.events.onResize=this._onResize.bind(this),t.container.addEventListener("click",e.events.onClick),1===Object.keys(g).length&&(document.addEventListener("mousedown",e.events.onMouseDown),document.addEventListener("touchstart",e.events.onMouseDown),window.addEventListener("resize",e.events.onResize)),t.suggestList.addEventListener("mouseover",e.events.onMouseOver),t.input.addEventListener("focus",e.events.onFocus)}},{key:"_onMouseOver",value:function(e){var t=e.target;if(t.classList.contains("tokenfield-suggest-item")){var s=this._html.suggestList.querySelectorAll(".selected");Array.prototype.forEach.call(s,function(e){e!==t&&e.classList.remove("selected")}),t.classList.add("selected"),this._selectItem(t.key),this._refreshItemsSelection()}}},{key:"_onFocus",value:function(e){var t=this._vars,s=this._html;t.events.onKeyDown=this._onKeyDown.bind(this),t.events.onFocusOut=this._onFocusOut.bind(this),s.input.removeEventListener("keydown",t.events.onKeyDown),s.input.addEventListener("keydown",t.events.onKeyDown),s.input.addEventListener("focusout",t.events.onFocusOut),this.focus(),s.input.value.trim().length>=this._options.minChars&&this.showSuggestions()}},{key:"_onFocusOut",value:function(e){var t=this._vars,s=this._html;s.input.removeEventListener("keydown",t.events.onKeyDown),s.input.removeEventListener("focusout",t.events.onFocusOut),s.container.contains(e.target)||this.hideSuggestions()}},{key:"_onMouseDown",value:function(e){var t=null;for(var s in g)if(g[s]._html.container.contains(e.target)){t=g[s];break}if(t)for(var s in g)s!==t.id&&(g[s].hideSuggestions(),g[s].blur());else for(var s in g)g[s].hideSuggestions(),g[s].blur()}},{key:"_onResize",value:function(){this._resizeInput(this._html.input.value)}},{key:"_onKeyDown",value:function(e){var t=this,s=this._vars,n=this._options,i=this._html;return"tokenfield"===n.mode&&setTimeout(function(){t._resizeInput(i.input.value)},1),"undefined"!=typeof s.keys[e.keyCode]?(this._keyAction(e),!0):(this._defocusItems()._renderItems(),clearTimeout(s.timer),this._abortXhr(),void(n.maxItems&&s.setItems.length>=n.maxItems?e.preventDefault():setTimeout(function(){t._keyInput(e)},1)))}},{key:"_keyAction",value:function(e){var t=this,s=null,n=this._vars,i=this.key,r=this._options,o=this._html,u=n.keys[e.keyCode],a=o.input.value.trim(),l=this._getSelectedItems();switch(l.length&&(s=l[0]),u){case"esc":this._deselectItems()._defocusItems()._renderItems().hideSuggestions();break;case"up":this._vars.suggested&&(this._selectPrevItem()._refreshItemsSelection(),e.preventDefault()),this._defocusItems()._renderItems();break;case"down":this._vars.suggested&&(this._selectNextItem()._refreshItemsSelection(),e.preventDefault()),this._defocusItems()._renderItems();break;case"left":this._focusPrevItem();break;case"right":this._focusNextItem();break;case"enter":if(this._abortXhr(),this._defocusItems(),1==n.setItems.length&&!r.multiple)return!1;a=this.onInput(a),s?this._addItem(s):a.length&&(s=this._newItem(a)),s&&this._renderItems()._refreshInput(!0).hideSuggestions()._deselectItems(),e.preventDefault();break;case"delete":if(this._abortXhr(),a.length<r.minChars){this.hideSuggestions();var h=this.getFocusedItem();"tokenfield"===r.mode&&!a.length&&n.setItems.length?h?this._removeItem(h[i]):this._focusItem(n.setItems[n.setItems.length-1][i]):h&&this._removeItem(h[i]),this._renderItems()._refreshInput()}else n.timer=setTimeout(function(){t._keyInput(e)},r.delay)}}},{key:"_keyInput",value:function(e){var t=this,s=this._vars,n=this._options,i=this._html;this._defocusItems();var r=this.onInput(i.input.value.trim(),e);if(r.length<n.minChars)return this.hideSuggestions(),!1;if(1==s.setItems.length&&!n.multiple)return!1;if("undefined"==typeof s.cache[r]){if(n.remote.url)s.timer=setTimeout(function(){t._fetchData(r)},n.delay);else if(!n.remote.url&&n.items.length){var o=this._prepareData(this.remapData(n.items)),u=this._filterData(r,o);s.suggestedItems=this._filterSetItems(u),this.showSuggestions()}}else{var o=this._prepareData(this.remapData(s.cache[r])),u=this._filterData(r,o);s.suggestedItems=this._filterSetItems(u),this.showSuggestions()}}},{key:"_onClick",value:function(e){var t=e.target;if(t.classList.contains("item-remove")){var s=this._getItem(t.key);this._removeItem(t.key)._renderItems().focus()}else if(t.classList.contains("tokenfield-suggest-item")){var s=this._getSuggestedItem(t.key);this._addItem(s)._renderItems()._refreshInput(!0).hideSuggestions()}else this.focus(),this._keyInput(e)}},{key:"_selectPrevItem",value:function(){var e=this.key,t=this._options,s=this._vars.suggestedItems,n=this._getSelectedItemIndex();return s.length?(null!==n?0===n?t.newItems?this._deselectItems():this._selectItem(s[s.length-1][e]):this._selectItem(s[n-1][e]):this._selectItem(s[s.length-1][e]),this):this}},{key:"_selectNextItem",value:function(){var e=this.key,t=this._options,s=this._vars.suggestedItems,n=this._getSelectedItemIndex();return s.length?(null!==n?n===s.length-1?t.newItems?this._deselectItems():this._selectItem(s[0][e]):this._selectItem(s[n+1][e]):this._selectItem(s[0][e]),this):this}},{key:"_focusPrevItem",value:function(){var e=this.key,t=this._vars.setItems,s=this._getFocusedItemIndex();return t.length?(null!==s?0===s?this._defocusItems():this._focusItem(t[s-1][e]):this._focusItem(t[t.length-1][e]),this._renderItems(),this):this}},{key:"_focusNextItem",value:function(){var e=this.key,t=this._vars.setItems,s=this._getFocusedItemIndex();return t.length?(null!==s?s===t.length-1?this._defocusItems():this._focusItem(t[s+1][e]):this._focusItem(t[0][e]),this._renderItems(),this):this}},{key:"_getSelectedItems",value:function(){var e=this.key,t=this._vars.setItems.map(function(t){return t[e]});return this._vars.suggestedItems.filter(function(s){return s.selected&&t.indexOf(s[e])<0})}},{key:"_selectItem",value:function(e){var t=this;this._vars.suggestedItems.forEach(function(s){s.selected=s[t.key]===e})}},{key:"_deselectItem",value:function(e){var t=this;return this._vars.suggestedItems.every(function(s){return s[t.key]===e?(s.selected=!1,!1):!0}),this}},{key:"_deselectItems",value:function(){return this._vars.suggestedItems.forEach(function(e){e.selected=!1}),this}},{key:"_refreshItemsSelection",value:function(){this._vars.suggestedItems.forEach(function(e){e.selected&&e.el?e.el.classList.add("selected"):e.el.classList.remove("selected")})}},{key:"_getSelectedItemIndex",value:function(){var e=null;return this._vars.suggestedItems.every(function(t,s){return t.selected?(e=s,!1):!0}),e}},{key:"_getFocusedItemIndex",value:function(){var e=null;return this._vars.setItems.every(function(t,s){return t.focused?(e=s,!1):!0}),e}},{key:"_getItem",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1];null===t&&(t=this.key);var s=this._vars.setItems.filter(function(s){return s[t]===e});return s.length?s[0]:null}},{key:"_getSuggestedItem",value:function(e){var t=this,s=this._vars.suggestedItems.filter(function(s){return s[t.key]===e});return s.length?s[0]:null}},{key:"_removeItem",value:function(e){var t=this;return this._vars.setItems.every(function(s,n){return s[t.key]===e?(t.emit("removeToken",t,s),t._vars.setItems.splice(n,1),t.emit("removedToken",t),t.emit("change",t),!1):!0}),this}},{key:"_addItem",value:function(e){return e.focused=!1,this._getItem(e[this.key])||(this.emit("addToken",this,e),(!this._options.maxItems||this._options.maxItems&&this._vars.setItems.length<this._options.maxItems)&&(this._vars.setItems.push(e),this.emit("addedToken",this,e),this.emit("change",this))),this}},{key:"getFocusedItem",value:function(){var e=null;return this._vars.setItems.every(function(t){return t.focused?(e=t,!1):!0}),e}},{key:"_focusItem",value:function(e){var t=this;return this._vars.setItems.forEach(function(s){s.focused=s[t.key]===e}),this}},{key:"_defocusItems",value:function(){return this._vars.setItems.forEach(function(e){e.focused=!1}),this}},{key:"_newItem",value:function(e){var t=this._options,s=this._getItem(e,t.itemData);if(!s&&t.newItems){var n;n={isNew:!0},i(n,this.key,u()),i(n,t.itemData,e),s=n,this.emit("newToken",this,s)}return s?(this._addItem(s),s):null}},{key:"_buildEl",value:function(e){return a(e)}},{key:"_getBounds",value:function(){return this._html.container.getBoundingClientRect()}},{key:"_renderItems",value:function(){var e=this,t=this._vars,s=this._options,n=this._html;return n.items.innerHTML="",t.setItems.length&&t.setItems.forEach(function(t){var s=e._renderItem(t);n.items.appendChild(s),t.el=s,t.focused?t.el.classList.add("focused"):t.el.classList.remove("focused")}),t.setItems.length>1&&"tokenfield"===s.mode&&n.input.setAttribute("placeholder",""),this}},{key:"_renderItem",value:function(e){var t=this._options,s=this.renderSetItemHtml(e),n=s.querySelector(".item-label"),i=s.querySelector(".item-input"),r=s.querySelector(".item-remove");return r.key=e[this.key],i.setAttribute("name",(e.isNew?t.newItemName:t.itemName)+"[]"),i.value=e[e.isNew?t.newitemValue:t.itemValue]||null,n.textContent=this.renderSetItemLabel(e),e.focused&&s.classList.add("focused"),s}},{key:"onInput",value:function(e,t){return e}},{key:"renderSetItemHtml",value:function(){return this._buildEl(this._templates.setItem)}},{key:"renderSetItemLabel",value:function(e){return e[this._options.itemLabel]}},{key:"renderSuggestions",value:function(e){var t=this,s=this._vars,n=this._options,i=this._html,r=this._getSelectedItemIndex();return e.length?(i.suggestList.innerHTML="",s.suggestedItems.length?(n.newItems||null!==r||(e[0].selected=!0),e.every(function(e,s){if(s>=n.maxSuggest)return!1;var r=t.renderSuggestedItem(e);return e.el=r,i.suggestList.appendChild(r),!0}),this):this):this}},{key:"renderSuggestedItem",value:function(e){var t=this._options,s=this._buildEl(this._templates.suggestItem);return s.key=e[this.key],s.innerHTML=e[t.itemData],s.setAttribute("title",e[t.itemData]),e.selected&&s.classList.add("selected"),s}},{key:"showSuggestions",value:function(){return this._vars.suggestedItems.length?(this.emit("showSuggestions",this),(!this._options.maxItems||this._options.maxItems&&this._vars.setItems.length<this._options.maxItems)&&(this.renderSuggestions(this._vars.suggestedItems),this._html.suggest.style.display="block",this._vars.suggested=!0),this.emit("shownSuggestions",this)):this.hideSuggestions(),this}},{key:"hideSuggestions",value:function(){return this.emit("hideSuggestions",this),this._vars.suggested=!1,this._html.suggest.style.display="none",this._html.suggestList.innerHTML="",this.emit("hiddenSuggestions",this),this}},{key:"getItems",value:function(){return this._vars.setItems.map(function(e){return Object.assign({},e)})}},{key:"setItems",value:function(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];return this._vars.setItems=e,this._refreshInput(!0),this.hideSuggestions()._renderItems(),this.emit("change",this),this}},{key:"emptyItems",value:function(){return this._vars.setItems=[],this._refreshInput(!0),this.hideSuggestions()._renderItems(),this.emit("change",this),this}},{key:"focus",value:function(){return this._html.container.classList.add("focused"),this._html.input.focus(),this}},{key:"blur",value:function(){return this._html.container.classList.remove("focused"),this._html.input.blur(),this}},{key:"remove",value:function(){var e=this._html;e.container.parentElement.insertBefore(this.el,e.container),e.container.remove(),this.el.style.display="block",1===Object.keys(g).length&&(document.removeEventListener("mousedown",this._vars.events.onMouseDown),window.removeEventListener("resize",this._vars.events.onResize)),delete g[this.id],delete this.el.tokenfield}}]),t}(_["default"]);t["default"]=w,e.exports=t["default"]},function(e,t){function s(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return"function"==typeof e}function i(e){return"number"==typeof e}function r(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}e.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._maxListeners=void 0,s.defaultMaxListeners=10,s.prototype.setMaxListeners=function(e){if(!i(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},s.prototype.emit=function(e){var t,s,i,u,a,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(s=this._events[e],o(s))return!1;if(n(s))switch(arguments.length){case 1:s.call(this);break;case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:u=Array.prototype.slice.call(arguments,1),s.apply(this,u)}else if(r(s))for(u=Array.prototype.slice.call(arguments,1),l=s.slice(),i=l.length,a=0;i>a;a++)l[a].apply(this,u);return!0},s.prototype.addListener=function(e,t){var i;if(!n(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(t.listener)?t.listener:t),this._events[e]?r(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,r(this._events[e])&&!this._events[e].warned&&(i=o(this._maxListeners)?s.defaultMaxListeners:this._maxListeners,i&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},s.prototype.on=s.prototype.addListener,s.prototype.once=function(e,t){function s(){this.removeListener(e,s),i||(i=!0,t.apply(this,arguments))}if(!n(t))throw TypeError("listener must be a function");var i=!1;return s.listener=t,this.on(e,s),this},s.prototype.removeListener=function(e,t){var s,i,o,u;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(s=this._events[e],o=s.length,i=-1,s===t||n(s.listener)&&s.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(r(s)){for(u=o;u-- >0;)if(s[u]===t||s[u].listener&&s[u].listener===t){i=u;break}if(0>i)return this;1===s.length?(s.length=0,delete this._events[e]):s.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},s.prototype.removeAllListeners=function(e){var t,s;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(s=this._events[e],n(s))this.removeListener(e,s);else if(s)for(;s.length;)this.removeListener(e,s[s.length-1]);return delete this._events[e],this},s.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},s.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(n(t))return 1;if(t)return t.length}return 0},s.listenerCount=function(e,t){return e.listenerCount(t)}}]);