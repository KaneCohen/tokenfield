var Tokenfield=function(e){function t(i){if(s[i])return s[i].exports;var n=s[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var s={};return t.m=e,t.c=s,t.d=function(e,s,i){t.o(e,s)||Object.defineProperty(e,s,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var s=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(s,"a",s),s},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,s){e.exports=s(1).default},function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e){if(Array.isArray(e)){for(var t=0,s=Array(e.length);t<e.length;t++)s[t]=e[t];return s}return Array.from(e)}function r(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(){return(65536*(1+Math.random())|0).toString(16)+(65536*(1+Math.random())|0).toString(16)}function h(e,t){return e.indexOf(t)>=0}function m(e){for(var t=[e];e.parentNode;)e=e.parentNode,t.push(e);return t}function c(e){return e.nodeName?e:"string"==typeof e?document.querySelector(e):null}function d(e,t){return e.nodeName?e:(e=e.replace(/(\t|\n$)/g,""),D.innerHTML="",D.innerHTML=e,!0===t?D.childNodes:D.childNodes[0])}function f(e){if("string"==typeof e)return e;if(null===e)return"";var t=e+"";return"0"===t&&1/e==-1/0?"-0":t}function v(e){return e.key||e.keyIdentifier?e.key||String.fromCharCode(parseInt(e.keyIdentifier.substr(2),16)):null}function _(e){return e=f(e),e&&E.test(e)?e.replace(L,"\\$&"):e}function g(){return{_defaults:{focusedItem:null,cache:{},timer:null,xhr:null,suggested:!1,suggestedItems:[],setItems:[],events:{},delimiters:{}},_options:{el:null,form:!0,mode:"tokenfield",addItemOnBlur:!1,addItemsOnPaste:!1,keepItemsOrder:!0,setItems:[],items:[],newItems:!0,multiple:!0,maxItems:0,minLength:0,keys:{17:"ctrl",16:"shift",91:"meta",8:"delete",27:"esc",37:"left",38:"up",39:"right",40:"down",46:"delete",65:"select",67:"copy",88:"cut",9:"delimiter",13:"delimiter",108:"delimiter"},matchRegex:"{value}",matchFlags:"i",matchStart:!1,matchEnd:!1,delimiters:[],copyProperty:"name",copyDelimiter:", ",remote:{type:"GET",url:null,queryParam:"q",delay:300,timestampParam:"t",params:{},headers:{}},placeholder:null,inputType:"text",minChars:2,maxSuggest:10,maxSuggestWindow:10,filterSetItems:!0,filterMatchCase:!1,singleInput:!1,singleInputValue:"id",singleInputDelimiter:", ",itemLabel:"name",itemName:"items",newItemName:"items_new",itemValue:"id",newItemValue:"name",itemData:"name",validateNewItem:null}}}Object.defineProperty(t,"__esModule",{value:!0});var p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e},I=function(){function e(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,s,i){return s&&e(t.prototype,s),i&&e(t,i),t}}(),k=s(2),w=i(k),b=s(3),S=i(b),x={},L=/[\\^$.*+?()[\]{}|]/g,E=RegExp(L.source),D=document.createElement("div"),C={containerTokenfield:'<div class="tokenfield tokenfield-mode-tokens">\n      <input class="tokenfield-copy-helper"\n        style="display:none;position:fixed;top:-1000px;right:1000px;"\n        tabindex="-1"\n        type="text"\n      />\n      <div class="tokenfield-set">\n        <ul></ul>\n      </div>\n      <input class="tokenfield-input" />\n      <div class="tokenfield-suggest">\n        <ul class="tokenfield-suggest-list"></ul>\n      </div>\n    </div>',containerList:'<div class="tokenfield tokenfield-mode-list">\n      <input class="tokenfield-input" />\n      <div class="tokenfield-suggest">\n        <ul class="tokenfield-suggest-list"></ul>\n      </div>\n      <div class="tokenfield-set">\n        <ul></ul>\n      </div>\n    </div>',suggestItem:'<li class="tokenfield-suggest-item"></li>',setItem:'<li class="tokenfield-set-item">\n      <span class="item-label"></span>\n      <a href="#" class="item-remove" tabindex="-1">Ã—</a>\n      <input class="item-input" type="hidden" />\n    </li>'},O=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,t);var s=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),i=g(),n=i._defaults,r=i._options;s.id=a(),s.key="key_"+s.id,s._vars=y({},n),s._options=y({},r,e),s._options.keys=y({},r.keys,e.keys),s._options.remote=y({},r.remote,e.remote),s._templates=y({},C,e.templates),s._vars.setItems=s._prepareData(s.remapData(s._options.setItems||[])),s._focused=!1,s._input=null,s._form=!1,s._html={};var l=s._options;l.delimiters.forEach(function(e){s._vars.delimiters[e]=!0});var h=c(l.el);if(!h)throw new Error("Selector: DOM Element "+l.el+" not found.");if(s.el=h,l.singleInput){var m=c(l.singleInput);s._input=m||s.el}if(s.el.tokenfield=s,null===l.placeholder&&(l.placeholder=l.el.placeholder||""),!l.form)throw new Error("Cannot create tokenfield without DOM Element.");var d=!1;if(l.form.nodeName)d=l.form;else if(!0===l.form)for(var f=s.el;f.parentNode;){if("FORM"===f.nodeName){d=f;break}f=f.parentNode}else if("string"==typeof d&&!(d=document.querySelector(d)))throw new Error("Selector: DOM Element "+l.form+" not found.");return s._form=d,x[s.id]=s,s._render(),s}return l(t,e),I(t,[{key:"_render",value:function(){var e=this._options,t=this._html;return"tokenfield"===e.mode?t.container=d(this._templates.containerTokenfield):t.container=d(this._templates.containerList),t.suggest=t.container.querySelector(".tokenfield-suggest"),t.suggestList=t.container.querySelector(".tokenfield-suggest-list"),t.items=t.container.querySelector(".tokenfield-set > ul"),t.input=t.container.querySelector(".tokenfield-input"),t.input.setAttribute("type",e.inputType),"tokenfield"===e.mode?t.input.placeholder=this._vars.setItems.length?"":e.placeholder:t.input.placeholder=e.placeholder,t.copyHelper=t.container.querySelector(".tokenfield-copy-helper"),e.el.style.display="none",t.suggest.style.display="none",this._renderSizer(),t.container.tokenfield=this,e.el.parentElement.insertBefore(t.container,e.el),t.container.insertBefore(e.el,t.container.firstChild),this._setEvents(),this._renderItems(),"tokenfield"===e.mode&&this._resizeInput(),this}},{key:"_renderSizer",value:function(){var e=this._html,t=this._getBounds(),s=window.getComputedStyle(e.container),i=parseInt(s.paddingLeft,10)+parseInt(s.paddingRight,10),n={width:"auto",height:"auto",overflow:"hidden",whiteSpace:"pre",maxWidth:t.width-i+"px",position:"fixed",top:-1e4+"px",left:1e4+"px",fontSize:s.fontSize,paddingLeft:s.paddingLeft,paddingRight:s.paddingRight};e.sizer=document.createElement("div"),e.sizer.id="tokenfield-sizer-"+this.id;for(var r in n)e.sizer.style[r]=n[r];e.container.appendChild(e.sizer)}},{key:"_refreshInput",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this._vars,s=this._html;if(e&&(s.input.value=""),"tokenfield"===this._options.mode){this._resizeInput();var i=t.setItems.length?"":this._options.placeholder;s.input.setAttribute("placeholder",i)}else"list"===this._options.mode&&s.input.setAttribute("placeholder",this._options.placeholder);return this}},{key:"_resizeInput",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=this._html,s=this._getBounds(),i=window.getComputedStyle(t.container),n=parseInt(i.paddingRight,10)+parseInt(i.borderRightWidth,10),r=n+parseInt(i.paddingLeft,10)+parseInt(i.borderLeftWidth,10);if(t.sizer.innerHTML=e,t.sizer.style.maxWidth=s.width-n+"px",0===s.width)return void(t.input.style.width="100%");t.input.style.width="20px";var o=t.sizer.getBoundingClientRect(),u=t.input.getBoundingClientRect(),l=s.width-(u.left-s.left)-n;o.width>l?t.input.style.width=s.width-r+"px":t.input.style.width=l+"px"}},{key:"_fetchData",value:function(e){var t=this,s=this._vars,i=this._options,n=i.remote,r=y({},i.params);for(var o in n.params)r[o]=n.params[o];n.limit&&(r[n.limit]=i.remote.limit),r[n.queryParam]=e,r[n.timestampParam]=Math.round((new Date).getTime()/1e3),s.xhr=(0,S.default)(r,i.remote,function(){if(s.xhr&&4==s.xhr.readyState){if(200==s.xhr.status){var n=JSON.parse(s.xhr.responseText);s.cache[e]=n;var r=t._prepareData(t.remapData(n)),o=t._filterData(e,r);s.suggestedItems=i.filterSetItems?t._filterSetItems(o):o,t.showSuggestions()}else if(s.xhr.status>0)throw new Error("Error while loading remote data.");t._abortXhr()}})}},{key:"remapData",value:function(e){return e}},{key:"_prepareData",value:function(e){var t=this;return e.map(function(e){return y({},e,r({},t.key,a()))})}},{key:"_filterData",value:function(e,t){var s=this._options,i=s.matchRegex.replace("{value}",_(e));s.matchStart?i="^"+i:s.matchEnd&&(i+="$");var n=new RegExp(i,s.matchFlags);return t.filter(function(e){return n.test(e[s.itemData])})}},{key:"_abortXhr",value:function(){var e=this._vars;null!==e.xhr&&(e.xhr.abort(),e.xhr=null)}},{key:"_filterSetItems",value:function(e){var t=this._options.itemValue,s=this._vars;if(!s.setItems.length)return e;var i=s.setItems.map(function(e){return e[t]});return e.filter(function(e){return-1===i.indexOf(e[t])})}},{key:"_setEvents",value:function(){var e=this._vars,t=this._html;e.events.onClick=this._onClick.bind(this),e.events.onMouseDown=this._onMouseDown.bind(this),e.events.onMouseOver=this._onMouseOver.bind(this),e.events.onFocus=this._onFocus.bind(this),e.events.onResize=this._onResize.bind(this),e.events.onReset=this._onReset.bind(this),e.events.onKeyDown=this._onKeyDown.bind(this),e.events.onFocusOut=this._onFocusOut.bind(this),t.container.addEventListener("click",e.events.onClick),1===Object.keys(x).length&&(document.addEventListener("mousedown",e.events.onMouseDown),window.addEventListener("resize",e.events.onResize)),this._form&&this._form.nodeName&&this._form.addEventListener("reset",e.events.onReset),t.suggestList.addEventListener("mouseover",e.events.onMouseOver),t.input.addEventListener("focus",e.events.onFocus)}},{key:"_onMouseOver",value:function(e){var t=e.target;if(t.classList.contains("tokenfield-suggest-item")){[].slice.call(this._html.suggestList.querySelectorAll(".selected")).forEach(function(e){e!==t&&e.classList.remove("selected")}),t.classList.add("selected"),this._selectItem(t.key,!1),this._refreshItemsSelection()}}},{key:"_onReset",value:function(){this.setItems(this._options.setItems)}},{key:"_onFocus",value:function(){var e=this._vars,t=this._html,s=this._options;t.input.removeEventListener("keydown",e.events.onKeyDown),t.input.addEventListener("keydown",e.events.onKeyDown),t.input.addEventListener("focusout",e.events.onFocusOut),s.addItemsOnPaste&&(e.events.onPaste=this._onPaste.bind(this),t.input.addEventListener("paste",e.events.onPaste)),this._focused=!0,this._html.container.classList.add("focused"),this._resizeInput(),t.input.value.trim().length>=s.minChars&&this.showSuggestions()}},{key:"_onFocusOut",value:function(e){var t=this._vars,s=this._options,i=this._html;if(i.input.removeEventListener("keydown",t.events.onKeyDown),i.input.removeEventListener("focusout",t.events.onFocusOut),void 0!==t.events.onPaste&&i.input.removeEventListener("paste",t.events.onPaste),!e.relatedTarget||e.relatedTarget!==i.copyHelper){var n=s.multiple&&!s.maxItems||!s.multiple&&!t.setItems.length||s.multiple&&s.maxItems&&t.setItems.length<s.maxItems;this._focused&&s.addItemOnBlur&&n&&this._newItem(i.input.value)?this._renderItems()._refreshInput():this._defocusItems()._renderItems(),this._focused=!1,this._html.container.classList.remove("focused")}}},{key:"_onMouseDown",value:function(e){var t=null;for(var s in x)if(x[s]._html.container.contains(e.target)){t=x[s];break}if(t){for(var i in x)i!==t.id&&(x[i].hideSuggestions(),x[i].blur());e.target!==t._html.input&&e.preventDefault()}else for(var n in x)x[n].hideSuggestions(),x[n].blur()}},{key:"_onResize",value:function(){for(var e in x)x[e]._resizeInput(x[e]._html.input.value)}},{key:"_onPaste",value:function(e){var t=this,s=this._vars,i=this._options,n=e.clipboardData.getData("text"),r=[n];if(i.delimiters.length){var o=i.delimiters.join("|"),u=new RegExp("("+o+")","ig");r=n.split(u)}r.map(function(e){return e.trim()}).filter(function(e){return e.length>0&&e.length>=i.minLength&&void 0===s.delimiters[e]}).map(function(e){return t._newItem(e)}).length&&(setTimeout(function(){t._renderItems()._refreshInput()._deselectItems().hideSuggestions()},1),e.preventDefault())}},{key:"_onKeyDown",value:function(e){var t=this,s=this._vars,i=this._options,n=this._html;i.maxItems&&s.setItems.length>=i.maxItems&&e.preventDefault(),"tokenfield"===i.mode&&setTimeout(function(){t._resizeInput(n.input.value)},1);var r=v(e);if(void 0!==i.keys[e.keyCode]||h(i.delimiters,r)){if(this._keyAction(e))return!0}else this._defocusItems()._refreshItems();clearTimeout(s.timer),this._abortXhr(),(!i.maxItems||s.setItems.length<i.maxItems)&&setTimeout(function(){t._keyInput(e)},1)}},{key:"_keyAction",value:function(e){var t=this,s=(this.key,null),i=this._vars,n=this._options,r=this._html,o=n.keys[e.keyCode],u=r.input.value.trim(),l=v(e);h(n.delimiters,l)&&void 0===o&&(o="delimiter");var a=this._getSelectedItems();switch(a.length&&(s=a[0]),o){case"esc":this._deselectItems()._defocusItems()._renderItems().hideSuggestions();break;case"up":this._vars.suggested&&(this._selectPrevItem()._refreshItemsSelection(),e.preventDefault()),this._defocusItems()._renderItems();break;case"down":this._vars.suggested&&(this._selectNextItem()._refreshItemsSelection(),e.preventDefault()),this._defocusItems()._renderItems();break;case"left":(this.getFocusedItems().length||!r.input.selectionStart&&!r.input.selectionEnd)&&(this._focusPrevItem(e.shiftKey),e.preventDefault());break;case"right":(this.getFocusedItems().length||r.input.selectionStart===u.length)&&(this._focusNextItem(e.shiftKey),e.preventDefault());break;case"delimiter":if(this._abortXhr(),this._defocusItems(),!n.multiple&&i.setItems.length>=1)return!1;u=this.onInput(u,e),s?this._addItem(s):u.length&&(s=this._newItem(u)),s&&this._renderItems().focus()._refreshInput()._refreshSuggestions()._deselectItems(),e.preventDefault();break;case"select":if(u.length||!e.ctrlKey&&!e.metaKey)return!1;this._vars.setItems.forEach(function(e){e.focused=!0}),this._refreshItems();break;case"cut":if(!this.getFocusedItems().length||!e.ctrlKey&&!e.metaKey)return!1;this._copy()._delete(e);break;case"copy":if(!this.getFocusedItems().length||!e.ctrlKey&&!e.metaKey)return!1;this._copy();break;case"delete":this._abortXhr();var m=this.getFocusedItems();!r.input.selectionEnd&&8===e.keyCode||r.input.selectionStart===u.length&&46===e.keyCode||m.length?this._delete(e):i.timer=setTimeout(function(){t._keyInput(e)},n.delay)}return!0}},{key:"_copy",value:function(){var e=this._options,t=this._html,s=this.getFocusedItems().map(function(t){return t[e.copyProperty]}).join(e.copyDelimiter);return t.copyHelper.style.display="block",t.copyHelper.value=s,t.copyHelper.focus(),t.copyHelper.select(),document.execCommand("copy"),t.copyHelper.style.display="none",t.copyHelper.value="",t.input.focus(),this}},{key:"_delete",value:function(e){var t=this,s=this._vars,i=this._options,n=this.key,r=this._html,o=this.getFocusedItems();return"tokenfield"===i.mode&&s.setItems.length?o.length?(o.forEach(function(e){t._removeItem(e[n])}),this._refreshSuggestions()._keyInput(e)):r.input.selectionStart||this._focusItem(s.setItems[s.setItems.length-1][n]):o.length&&(o.forEach(function(e){t._removeItem(e[n])}),this._refreshSuggestions()._keyInput(e)),this._renderItems()._refreshInput(!1),this}},{key:"_keyInput",value:function(e){var t=this,s=this._vars,i=this._options,n=this._html;this._defocusItems()._refreshItems();var r=this.onInput(n.input.value.trim(),e);if("keydown"===e.type&&this.emit("input",this,r,e),r.length<i.minChars)return this.hideSuggestions(),!1;if(!i.multiple&&s.setItems.length>=1)return!1;if(void 0===s.cache[r]){if(i.remote.url)s.timer=setTimeout(function(){t._fetchData(r)},i.delay);else if(!i.remote.url&&i.items.length){var o=this._prepareData(i.items),u=this._filterData(r,o);s.suggestedItems=i.filterSetItems?this._filterSetItems(u):u,this.showSuggestions()}}else{var l=this._prepareData(this.remapData(s.cache[r])),a=this._filterData(r,l);s.suggestedItems=i.filterSetItems?this._filterSetItems(a):a,this.showSuggestions()}return this}},{key:"_onClick",value:function(e){var t=e.target;if(t.classList.contains("item-remove"))e.preventDefault(),this._removeItem(t.key)._defocusItems()._renderItems()._refreshInput(!1)._keyInput(e);else if(t.classList.contains("tokenfield-suggest-item")){var s=this._getSuggestedItem(t.key);this._addItem(s)._renderItems()._refreshInput()._refreshSuggestions()}else{var i=m(t).filter(function(e){return e.classList&&e.classList.contains("tokenfield-set-item")})[0];i?(this._focusItem(i.key,e.shiftKey,e.ctrlKey||e.metaKey,!0),this._refreshItems()):this._keyInput(e)}this.focus()}},{key:"_selectPrevItem",value:function(){var e=this.key,t=this._options,s=this._vars.suggestedItems,i=this._getSelectedItemIndex();return s.length?(null!==i?0===i?t.newItems?this._deselectItems():this._selectItem(s[s.length-1][e]):this._selectItem(s[i-1][e]):this._selectItem(s[s.length-1][e]),this):this}},{key:"_selectNextItem",value:function(){var e=this.key,t=this._options,s=this._vars.suggestedItems,i=this._getSelectedItemIndex();return s.length?(null!==i?i===s.length-1?t.newItems?this._deselectItems():this._selectItem(s[0][e]):this._selectItem(s[i+1][e]):this._selectItem(s[0][e]),this):this}},{key:"_focusPrevItem",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.key,s=this._vars.setItems,i=this._getFocusedItemIndex();if(!s.length)return this;if(null!==i)if(0!==i||e)if(0===i&&e){var n=this._getFocusedItemIndex(!0);this._defocusItem(s[n][t])}else this._focusItem(s[i-1][t],e,!1,!0);else this._defocusItems();else this._focusItem(s[s.length-1][t],!1,!1,!0);return this._refreshItems(),this}},{key:"_focusNextItem",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.key,s=this._vars.setItems,i=this._getFocusedItemIndex(!0);return s.length?(null!==i?i!==s.length-1||e?i===s.length-1&&e?this._focusItem(s[0][t],e):this._focusItem(s[i+1][t],e):this._defocusItems():this._focusItem(s[0][t],!1),this._refreshItems(),this):this}},{key:"_getSelectedItems",value:function(){var e=this.key,t=this._vars.setItems.map(function(t){return t[e]});return this._vars.suggestedItems.filter(function(s){return s.selected&&t.indexOf(s[e])<0})}},{key:"_selectItem",value:function(e){var t=this,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._vars.suggestedItems.forEach(function(i){if(i.selected=i[t.key]===e,i.selected&&s){var n=parseInt(t._html.suggest.style.maxHeight,10);if(n){var r=t._html.suggestList.getBoundingClientRect(),o=i.el.getBoundingClientRect(),u=o.top-r.top,l=u+o.height;l>=n+t._html.suggest.scrollTop?t._html.suggest.scrollTop=l-n:u<t._html.suggest.scrollTop&&(t._html.suggest.scrollTop=u)}}})}},{key:"_deselectItem",value:function(e){var t=this;return this._vars.suggestedItems.every(function(s){return s[t.key]!==e||(s.selected=!1,!1)}),this}},{key:"_deselectItems",value:function(){return this._vars.suggestedItems.forEach(function(e){e.selected=!1}),this}},{key:"_refreshItemsSelection",value:function(){this._vars.suggestedItems.forEach(function(e){e.selected&&e.el?e.el.classList.add("selected"):e.el&&e.el.classList.remove("selected")})}},{key:"_getSelectedItemIndex",value:function(){var e=null;return this._vars.suggestedItems.every(function(t,s){return!t.selected||(e=s,!1)}),e}},{key:"_getFocusedItemIndex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=null;return this._vars.setItems.every(function(s,i){return!(s.focused&&(t=i,!e))}),t}},{key:"_getItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===t&&(t=this.key);var s=this._filterItems(this._vars.setItems,e,t);return s.length?s[0]:null}},{key:"_getSuggestedItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===t&&(t=this.key);var s=this._filterItems(this._vars.suggestedItems,e,t);return s.length?s[0]:null}},{key:"_getAvailableItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===t&&(t=this.key);var s=this._filterItems(this._options.items,e,t);return s.length?s[0]:null}},{key:"_filterItems",value:function(e,t,s){var i=this._options.filterMatchCase;return e.filter(function(e){return"string"==typeof e[s]&&"string"==typeof t?i?e[s]===t:e[s].toLowerCase()==t.toLowerCase():e[s]==t})}},{key:"_removeItem",value:function(e){var t=this;return this._vars.setItems.every(function(s,i){return s[t.key]!==e||(t.emit("removeToken",t,s),t._vars.setItems.splice(i,1),t.emit("removedToken",t,s),t.emit("change",t),!1)}),this}},{key:"_addItem",value:function(e){e.focused=!1;var t=this._options;if((e.isNew&&!this._getItem(e[t.itemData],t.itemData)||!this._getItem(e[t.itemValue],t.itemValue))&&(this.emit("addToken",this,e),!this._options.maxItems||this._options.maxItems&&this._vars.setItems.length<this._options.maxItems)){e.selected=!1;var s=y({},e);this._vars.setItems.push(s),this.emit("addedToken",this,s),this.emit("change",this)}return this}},{key:"getFocusedItem",value:function(){var e=this._vars.setItems.filter(function(e){return e.focused})[0];return e.length?e[0]:null}},{key:"getFocusedItems",value:function(){return this._vars.setItems.filter(function(e){return e.focused})}},{key:"_focusItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(t){var r=null,o=null,u=null,l=this._vars.setItems.length;if(this._vars.setItems.forEach(function(t,i){t[s.key]===e&&(u=i),null===r&&t.focused&&(r=i),t.focused&&(o=i)}),(0===u||u===l-1)&&null===r&&null===o)return;null===r&&null===o?this._vars.setItems[u].focused=!0:0!==u||o!==l-1||n?(r=Math.min(u,r),o=Math.max(u,o),this._vars.setItems.forEach(function(e,t){e.focused=u===t||t>=r&&t<=o})):this._vars.setItems[r].focused=!1}else this._vars.setItems.forEach(function(t){t.focused=i?t[s.key]===e?!t.focused:t.focused:t[s.key]===e});return this}},{key:"_defocusItem",value:function(e){var t=this;return this._vars.setItems.filter(function(s){s[t.key]===e&&(s.focused=!1)})}},{key:"_defocusItems",value:function(){return this._vars.setItems.forEach(function(e){e.focused=!1}),this}},{key:"_newItem",value:function(e){var t=this._options;if("string"==typeof e&&(!e.length||e.length<t.minLength))return null;var s=this._getItem(e,t.itemData)||this._getSuggestedItem(e,t.itemData)||this._getAvailableItem(e,t.itemData);if(!s&&t.newItems){var i;if("function"==typeof t.validateNewItem&&!t.validateNewItem(e))return null;i={isNew:!0},r(i,this.key,a()),r(i,t.itemData,e),s=i,this.emit("newToken",this,s)}return s?(this._addItem(s),s):null}},{key:"_buildEl",value:function(e){return d(e)}},{key:"_getBounds",value:function(){return this._html.container.getBoundingClientRect()}},{key:"_renderItems",value:function(){var e=this,t=this._vars,s=this._options,i=this._html;return i.items.innerHTML="",t.setItems.forEach(function(t,s){var n=e._renderItem(t,s);i.items.appendChild(n),t.el=n,t.focused?t.el.classList.add("focused"):t.el.classList.remove("focused")}),t.setItems.length>1&&"tokenfield"===s.mode?i.input.setAttribute("placeholder",""):"list"===s.mode&&i.input.setAttribute("placeholder",s.placeholder),this._input&&(this._input.value=t.setItems.map(function(e){return e[s.singleInputValue]}).join(s.singleInputDelimiter)),this}},{key:"_refreshItems",value:function(){this._vars.setItems.forEach(function(e){e.el&&(e.focused?e.el.classList.add("focused"):e.el.classList.remove("focused"))})}},{key:"_renderItem",value:function(e,t){var s=this._options,i=this.renderSetItemHtml(e),n=i.querySelector(".item-label"),r=i.querySelector(".item-input"),o=i.querySelector(".item-remove"),u=s.keepItemsOrder?"["+t+"]":"[]";return i.key=e[this.key],o.key=e[this.key],r.setAttribute("name",(e.isNew?s.newItemName:s.itemName)+u),r.value=e[e.isNew?s.newItemValue:s.itemValue]||null,n.textContent=this.renderSetItemLabel(e),e.focused&&i.classList.add("focused"),i}},{key:"onInput",value:function(e,t){return e}},{key:"renderSetItemHtml",value:function(){return this._buildEl(this._templates.setItem)}},{key:"renderSetItemLabel",value:function(e){return e[this._options.itemLabel]}},{key:"renderSuggestions",value:function(e){var t=this,s=this._vars,i=this._options,n=this._html,r=this._getSelectedItemIndex();if(!e.length)return this;if(0===i.maxSuggestWindow&&(n.suggest.style.maxHeight=null),!s.suggestedItems.length)return this;i.newItems||null!==r||(e[0].selected=!0);var o=0;e.every(function(e,s){if(s>=i.maxSuggest)return!1;var r=n.suggestList.childNodes[s],u=e.el=t.renderSuggestedItem(e);return r?r.itemValue===e[i.itemValue]?(r.key=e[t.key],e.el=r):n.suggestList.replaceChild(u,r):r||n.suggestList.appendChild(u),i.maxSuggestWindow>0&&s<i.maxSuggestWindow&&(o+=n.suggestList.childNodes[s].getBoundingClientRect().height),i.maxSuggestWindow>0&&s===i.maxSuggestWindow&&(n.suggest.style.maxHeight=o+"px"),!0});var u=n.suggestList.childElementCount-e.length;if(u>0)for(var l=u-1;l>=0;l--)n.suggestList.removeChild(n.suggestList.childNodes[e.length+l]);return this}},{key:"renderSuggestedItem",value:function(e){var t=this._options,s=this._buildEl(this._templates.suggestItem);if(s.key=e[this.key],s.itemValue=e[t.itemValue],s.innerHTML=this.renderSuggestedItemContent(e),s.setAttribute("title",e[t.itemData]),e.selected&&s.classList.add("selected"),!t.filterSetItems){(this._getItem(e[t.itemValue],t.itemValue)||this._getItem(e[t.itemData],t.itemData))&&s.classList.add("set")}return s}},{key:"renderSuggestedItemContent",value:function(e){return e[this._options.itemData]}},{key:"_refreshSuggestions",value:function(){var e=this._vars,t=this._options;if(this._html.input.value.length<t.minChars)return this.hideSuggestions(),this;var s=this._prepareData(t.items),i=this._filterData(this._html.input.value,s);return e.suggestedItems=t.filterSetItems?this._filterSetItems(i):i,e.suggestedItems.length&&(!t.maxItems||t.maxItems&&e.setItems.length<t.maxItems)?(this.renderSuggestions(e.suggestedItems),this):(this.hideSuggestions(),this)}},{key:"showSuggestions",value:function(){var e=this._vars,t=this._options;return e.suggestedItems.length?(this.emit("showSuggestions",this),(!t.maxItems||t.maxItems&&e.setItems.length<t.maxItems)&&(this._html.suggest.style.display="block",e.suggested=!0,this.renderSuggestions(e.suggestedItems)),this.emit("shownSuggestions",this)):this.hideSuggestions(),this}},{key:"hideSuggestions",value:function(){return this.emit("hideSuggestions",this),this._vars.suggested=!1,this._html.suggest.style.display="none",this._html.suggestList.innerHTML="",this.emit("hiddenSuggestions",this),this}},{key:"setSuggestedItems",value:function(e){if(!Array.isArray(e))throw new Error("Argument must be an array of objects.");this._options.items=e,this._refreshSuggestions()}},{key:"getItems",value:function(){var e=this;return this._vars.setItems.map(function(t){var s=y({},t);return delete s[e.key],delete s.el,s})}},{key:"setItems",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this._vars.setItems=[],this.addItems(e),this}},{key:"addItems",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],s=this._options.itemValue;return Array.isArray(t)||(t=[t]),this._prepareData(t).forEach(function(t){(t.isNew||void 0!==t[s])&&e._addItem(t)}),this._renderItems()._refreshInput().hideSuggestions(),this}},{key:"sortItems",value:function(){var e=this,t=[];[].concat(n(this._html.items.childNodes)).forEach(function(s){var i=e._getItem(s.key);i&&t.push(i)}),this.setItems(t)}},{key:"removeItem",value:function(e){var t=this._options;"object"===(void 0===e?"undefined":p(e))&&(e[t.itemValue]||e[t.newItemValue])&&(e=e[t.itemValue]||e[t.newItemValue]);var s=this._getItem(e,t.itemValue)||this._getItem(e,t.newItemValue);return s?(this._removeItem(s[this.key])._renderItems(),this):this}},{key:"emptyItems",value:function(){return this._vars.setItems=[],this._renderItems()._refreshInput().hideSuggestions(),this.emit("change",this),this}},{key:"getSuggestedItems",value:function(){return this._vars.suggestedItems.map(function(e){return y({},e)})}},{key:"focus",value:function(){return this._html.container.classList.add("focused"),this._focused||this._html.input.focus(),this}},{key:"blur",value:function(){return this._html.container.classList.remove("focused"),this._focused&&this._html.input.blur(),this}},{key:"remove",value:function(){var e=this._html;e.container.parentElement.insertBefore(this.el,e.container),e.container.remove(),this.el.style.display="block",1===Object.keys(x).length&&(document.removeEventListener("mousedown",this._vars.events.onMouseDown),window.removeEventListener("resize",this._vars.events.onResize)),this._form&&this._form.nodeName&&this._form.removeEventListener("reset",this._vars.events.onReset),delete x[this.id],delete this.el.tokenfield}}]),t}(w.default);t.default=O},function(e,t){function s(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function n(e){return"number"==typeof e}function r(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}e.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._maxListeners=void 0,s.defaultMaxListeners=10,s.prototype.setMaxListeners=function(e){if(!n(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},s.prototype.emit=function(e){var t,s,n,u,l,a;if(this._events||(this._events={}),"error"===e&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var h=new Error('Uncaught, unspecified "error" event. ('+t+")");throw h.context=t,h}if(s=this._events[e],o(s))return!1;if(i(s))switch(arguments.length){case 1:s.call(this);break;case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:u=Array.prototype.slice.call(arguments,1),s.apply(this,u)}else if(r(s))for(u=Array.prototype.slice.call(arguments,1),a=s.slice(),n=a.length,l=0;l<n;l++)a[l].apply(this,u);return!0},s.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?r(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,r(this._events[e])&&!this._events[e].warned&&(n=o(this._maxListeners)?s.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},s.prototype.on=s.prototype.addListener,s.prototype.once=function(e,t){function s(){this.removeListener(e,s),n||(n=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var n=!1;return s.listener=t,this.on(e,s),this},s.prototype.removeListener=function(e,t){var s,n,o,u;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(s=this._events[e],o=s.length,n=-1,s===t||i(s.listener)&&s.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(r(s)){for(u=o;u-- >0;)if(s[u]===t||s[u].listener&&s[u].listener===t){n=u;break}if(n<0)return this;1===s.length?(s.length=0,delete this._events[e]):s.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},s.prototype.removeAllListeners=function(e){var t,s;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(s=this._events[e],i(s))this.removeListener(e,s);else if(s)for(;s.length;)this.removeListener(e,s[s.length-1]);return delete this._events[e],this},s.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},s.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},s.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,s){"use strict";function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=new XMLHttpRequest,n=t.url,r=[];for(var o in e)r.push(o+"="+encodeURIComponent(e[o]));var u=r.join("&");"get"===t.type.toLowerCase()&&(n+="?"+u),i.open(t.type,n,!0);for(var l in t.headers){var a=t.headers[l];"function"==typeof a&&(a=a(e,t)),i.setRequestHeader(l,a)}return s&&(i.onreadystatechange=s),i.send(e),i}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i}]);